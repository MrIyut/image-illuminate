{% extends 'app/base.html' %}
{% load static %}

{% block body %}
	<link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
	<p>Illuminate</p>
  
   <div class="dropdown">
        <button class="dropbtn" id="selectedOption" onclick="resetOrSelectOption('Model')">Model</button>
        <div class="dropdown-content">
        {% for index in options %}
            <a onclick="resetOrSelectOption('{{ index.value }}', '{{ index.label }}', '{{ index.image_url }}')" id="{{ index.value }}">
                <img src="{% static 'app/images-model/' %}{{ index.image_url }}" alt="Option Image" class="option-image">
                {{ index.label }}
            </a>
        {% endfor %}
        </div>
    </div>
  
	<form method="post" action="{% url 'index' %}">
		{% csrf_token %}
		<label for="Prompt">Enter Text:</label>
		<input type="text" id="Prompt" name="Prompt">
		<button type="submit">Run</button>
	</form>
	
	<!-- Download button -->

	{% if image_paths|length > 0 %}
		<a href="#" id="downloadBtn" class="download-btn" onclick="downloadImages()">Download</a>
		<div id="image-grid">
			{% for image_path in image_paths %}
			<div class="image-container">
				<img src="{% static 'app/images/' %}{{ image_path }}" alt="{{ image_path }}"
					style="max-width: 100%; height: auto;" id="generated_image">
			</div>
			{% endfor %}
		</div>

		<script>
			function downloadImages() {
				// Get all elements with the 'generated-image' id
				var images = document.querySelectorAll('[id^="generated_image"]');

				// Iterate through each image and create a download link
				images.forEach(function (image, index) {
					var imageUrl = image.src; // path to the image
					var downloadLink = document.createElement('a');

					// Set download link attributes
					downloadLink.href = imageUrl;
					downloadLink.download = 'image_' + (index + 1) + '.png';

					// Append the download link to the document and trigger a click
					document.body.appendChild(downloadLink);
					downloadLink.click();

					// Remove the download link from the document
					document.body.removeChild(downloadLink);
				});
			}
		</script>
	{% endif %}

  <script>
        /* Salvez ultima varianta selectata */
        var lastSelectedOption = '';

        function resetOrSelectOption(value, label, image_url) {
            // Remove 'selected' class from the last selected option
            if (lastSelectedOption !== '') {
                document.getElementById(lastSelectedOption).classList.remove('selected');
            }
                
            var selectedOptionButton = document.getElementById('selectedOption');
            var final_url = "{% static 'app/images-model/' %}" + image_url;

            if (lastSelectedOption == value) {
                document.getElementById('selectedOption').innerHTML = 'Model';
                selectedOptionButton.style.backgroundImage = 'none';
                lastSelectedOption = '';

                // Remove 'selected' class from the selected option
                document.getElementById(value).classList.remove('selected');
            } else {
                document.getElementById('selectedOption').innerHTML = value;
                selectedOptionButton.style.backgroundImage = 'url("' + final_url + '")';
                lastSelectedOption = value;

                // Add 'selected' class to the selected option
                document.getElementById(value).classList.add('selected'); 
            }
        }

    </script>
{% endblock %}